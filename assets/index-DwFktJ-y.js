var Mt=Object.defineProperty;var zt=(e,t,i)=>t in e?Mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var M=(e,t,i)=>zt(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function kt(e,t){let i=Math.sin(t),s=Math.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}function Z(e,t,i){return Math.min(Math.max(e,i),t)}let P=()=>{};function At(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}let D={};function N(e,t){D[e]=D[e]||[],D[e].push(t)}function V(e,...t){(D[e]||[]).map(i=>i(...t))}let z,X,ht={get(e,t){return t=="_proxy"?!0:P}};function St(){return z}function F(){return X}function Et(e,{contextless:t=!1}={}){if(z=document.getElementById(e)||e||document.querySelector("canvas"),t&&(z=z||new Proxy({},ht)),!z)throw Error("You must provide a canvas element for the game");return X=z.getContext("2d")||new Proxy({},ht),X.imageSmoothingEnabled=!1,V("init"),{canvas:z,context:X}}class A{constructor(t=0,i=0,s={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new A(this.x+t.x,this.y+t.y,this)}subtract(t){return new A(this.x-t.x,this.y-t.y,this)}scale(t){return new A(this.x*t,this.y*t)}normalize(t=this.length()||1){return new A(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,s,n){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Z(this._a,this._d,t):t}set y(t){this._y=this._c?Z(this._b,this._e,t):t}}function q(){return new A(...arguments)}class Ct{constructor(t){return this.init(t)}init(t={}){this.position=q(),this.velocity=q(),this.acceleration=q(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class It extends Ct{init({width:t=0,height:i=0,context:s=F(),render:n=this.draw,update:r=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:c=1,rotation:u=0,drotation:h=0,ddrotation:l=0,scaleX:f=1,scaleY:g=1,...d}={}){this._c=[],super.init({width:t,height:i,context:s,anchor:a,opacity:c,rotation:u,drotation:h,ddrotation:l,scaleX:f,scaleY:g,...d}),this._di=!0,this._uw(),this.addChild(o),this._rf=n,this._uf=r,N("init",()=>{this.context??(this.context=F())})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,s=this.height;this.radius&&(i=s=this.radius*2);let n=-i*this.anchor.x,r=-s*this.anchor.y;(n||r)&&t.translate(n,r),this.context.globalAlpha=this.opacity,this._rf(),(n||r)&&t.translate(-n,-r),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wrot:n=0,_wsx:r=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=n+this.rotation;let{x:a,y:c}=kt({x:this._wx,y:this._wy},n);this._wx=a,this._wy=c,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||P,i._pc()})}removeChild(...t){t.flat().map(i=>{At(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=Z(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class Lt extends It{init({image:t,width:i=t?t.width:void 0,height:s=t?t.height:void 0,...n}={}){super.init({image:t,width:i,height:s,...n})}get animations(){return this._a}set animations(t){let i,s;this._a={};for(i in t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function W(){return new Lt(...arguments)}function Pt(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function Rt({fps:e=60,clearCanvas:t=!0,update:i=P,render:s,context:n=F(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let o=0,a=1e3/e,c=1/e,u=t?Pt:P,h,l,f,g,d,v=!0;r||(window.addEventListener("focus",()=>{v=!0}),window.addEventListener("blur",()=>{v=!1})),N("init",()=>{d.context??(d.context=F())});function m(){if(l=requestAnimationFrame(m),!!v&&(f=performance.now(),g=f-h,h=f,!(g>1e3))){for(o+=g;o>=a;)V("tick"),d.update(c),o-=a;u(d.context),d.render()}}return d={update:i,render:s,isStopped:!0,context:n,start(){this.isStopped&&(h=performance.now(),this.isStopped=!1,requestAnimationFrame(m))},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:m,set _last(E){h=E}},d}let R=[],at={},ct={},Yt={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function Bt(e){R[e.gamepad.index]={pressedButtons:{},axes:{}}}function Ot(e){delete R[e.gamepad.index]}function Gt(){R.map(e=>{e.pressedButtons={},e.axes={}})}function Dt(){let e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let t=0;t<e.length;t++){let i=e[t];if(!i)continue;i.buttons.map((n,r)=>{let o=Yt[r],{pressed:a}=n,{pressedButtons:c}=R[i.index],u=c[o];!u&&a?[at[i.index],at].map(h=>{var l;(l=h==null?void 0:h[o])==null||l.call(h,i,n,o)}):u&&!a&&[ct[i.index],ct].map(h=>{var l;(l=h==null?void 0:h[o])==null||l.call(h,i,n,o)}),c[o]=a});let{axes:s}=R[i.index];s.leftstickx=i.axes[0],s.leftsticky=i.axes[1],s.rightstickx=i.axes[2],s.rightsticky=i.axes[3]}}function Xt(){window.addEventListener("gamepadconnected",Bt),window.addEventListener("gamepaddisconnected",Ot),window.addEventListener("blur",Gt),N("tick",Dt)}let dt={},ut={},T={},L={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function lt(e=P,t){e._pd&&t.preventDefault(),e(t)}function Ft(e){let t=L[e.code],i=dt[t];T[t]=!0,lt(i,e)}function Nt(e){let t=L[e.code],i=ut[t];T[t]=!1,lt(i,e)}function Tt(){T={}}function Ht(){let e;for(e=0;e<26;e++)L["Key"+String.fromCharCode(e+65)]=String.fromCharCode(e+97);for(e=0;e<10;e++)L["Digit"+e]=L["Numpad"+e]=""+e;window.addEventListener("keydown",Ft),window.addEventListener("keyup",Nt),window.addEventListener("blur",Tt)}function _(e,t,{handler:i="keydown",preventDefault:s=!0}={}){let n=i=="keydown"?dt:ut;t._pd=s,[].concat(e).map(r=>n[r]=t)}function Ut(e){return!![].concat(e).some(t=>T[t])}const $t={state:"green",progress:0},Kt=()=>W({name:"redLight",x:150,y:0,width:100,height:100,color:"red",update(t){this.solved||(this.initialized||(this.props={...$t},this.initialized=!0),this.color=this.props.state,Ut(["space"])&&(this.props.progress+=t*10,this.props.progress>=10&&(V("activate","redLight"),this.solved=!0)),this.advance())},render(){if(!this.initialized)return;this.draw();const t=this.context;t&&(t.save(),t.fillStyle="white",t.fillRect(10,this.height-this.props.progress-10,this.width-20,this.props.progress),t.restore())}}),S=48,O=8,qt=()=>W({width:S,height:S,color:"blue",update(e){this.gameModel&&(this.color=this.gameModel.position===this.name?"blue":"white",this.advance(e))},render(){if(!(!this.gameModel||this.width===void 0||this.height===void 0)&&this.gameModel.visitedRooms.includes(this.name)&&(this.draw(),this.gameModel.position===this.name)){let e=this.width/2-4,t=this.height/2-4;this.gameModel.facing=="n"&&(t=0),this.gameModel.facing=="s"&&(t=this.height-8),this.gameModel.facing=="w"&&(e=0),this.gameModel.facing=="e"&&(e=this.width-8),this.context&&(this.context.save(),this.context.fillStyle="green",this.context.fillRect(e,t,8,8),this.context.restore())}},views:[]}),jt=e=>{const t=St();return W({x:t.width/2,y:t.height/2,color:"red",width:128,height:128,anchor:{x:.5,y:.5},puzzles:[Kt()],lookInput(i){e.lookAt(i)},interactInput(i){e.interact(i)},update(i){if(!this.initialized){const s=[],n=(r,o,a)=>{if(r&&!s.includes(r.name)){s.push(r.name);const c=qt();c.gameModel=e,c.name=r.name,c.x=o,c.y=a,this.addChild(c),r.views.forEach(u=>{u.interaction!==void 0&&u.interaction.forEach(h=>{var v;if(!h.action)return;const[l,f]=(v=h.action)==null?void 0:v.split("_");if(l!="moveTo")return;let g=o,d=a;u.direction==="n"&&(d-=S+O),u.direction==="s"&&(d+=S+O),u.direction==="w"&&(g-=S+O),u.direction==="e"&&(g+=S+O),n(e.roomByName(f),g,d)})})}};n(e.map.rooms[0],0,0),_(["w","arrowup"],()=>{this.lookInput("n")}),_(["a","arrowleft"],()=>{this.lookInput("w")}),_(["s","arrowdown"],()=>{this.lookInput("s")}),_(["d","arrowright"],()=>{this.lookInput("e")}),_(["esc"],()=>{this.lookInput("")}),_(["space","enter"],()=>{this.interactInput(0),console.log("space")}),_(["1"],()=>{this.interactInput(1)}),_(["2"],()=>{this.interactInput(2)}),_(["3"],()=>{this.interactInput(3)}),this.initialized=!0}this.currentPuzzle=this.puzzles.find(s=>s.name===e.currentPuzzle),this.advance(i),this.currentPuzzle&&this.currentPuzzle.update(i)},render(){this.currentPuzzle&&this.currentPuzzle.render(),this.draw(),this.context&&(this.context.save(),this.context.fillStyle="black",this.context.font="12px mono",this.context.fillText(e.puzzle,13,120),this.context.restore())}})},Zt={title:"test",rooms:[{name:"lobby",intro:"You have arrived. Use the arrow keys to look around. Use space bar to interact.",description:"This is the lobby.",views:[{direction:"n",description:"A door to the kitchen.",interaction:[{condition:"kitchenDoor",message:"You walk through the open door.",action:"moveTo_kitchen"},{message:"It's locked!"}]},{direction:"e",description:"A flower with a delightful scent on a table.",interaction:[{condition:"kitchenDoor",message:"The button is pressed. What door opened?"},{message:"You find a hidden button and press it. A door opens.",action:"activate_kitchenDoor"}]},{direction:"s",description:"A locked door to the outside."},{direction:"w",description:"A mirror, which isn't too helpful."}]},{name:"kitchen",intro:"You walk into the kitchen",description:"This is the kitchen.",views:[{direction:"n",description:"Some pots and pans on a counter."},{direction:"e",description:"A gas stove.",puzzle:"redLight"},{direction:"s",interaction:[{action:"moveTo_lobby"}],description:"There is a door to the lobby."},{direction:"w",description:"A large sink."}]}]};function Vt(...e){return Wt.play(...e)}const Wt={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),i=this.x.createBufferSource();return e.map((s,n)=>t.getChannelData(n).set(s)),i.buffer=t,i.connect(this.x.destination),i.start(),i},buildSamples:function(e=1,t=.05,i=220,s=0,n=0,r=.1,o=0,a=1,c=0,u=0,h=0,l=0,f=0,g=0,d=0,v=0,m=0,E=1,C=0,Q=0,Y=0){let y=Math.PI*2,H=bt=>bt<0?-1:1,w=this.sampleRate,pt=c*=500*y/w/w,J=i*=(1+t*2*Math.random()-t)*y/w,U=[],b=0,ft=0,p=0,I=1,wt=0,mt=0,x=0,$,k,gt=2,tt=y*Math.abs(Y)*2/w,K=Math.cos(tt),it=Math.sin(tt)/2/gt,B=1+it,yt=-2*K/B,xt=(1-it)/B,et=(1+H(Y)*K)/2/B,_t=-(H(Y)+K)/B,vt=et,st=0,nt=0,rt=0,ot=0;for(s=s*w+9,C*=w,n*=w,r*=w,m*=w,u*=500*y/w**3,d*=y/w,h*=y/w,l*=w,f=f*w|0,e*=this.volume,k=s+C+n+r+m|0;p<k;U[p++]=x*e)++mt%(v*100|0)||(x=o?o>1?o>2?o>3?Math.sin(b**3):Math.max(Math.min(Math.tan(b),1),-1):1-(2*b/y%2+2)%2:1-4*Math.abs(Math.round(b/y)-b/y):Math.sin(b),x=(f?1-Q+Q*Math.sin(y*p/f):1)*H(x)*Math.abs(x)**a*(p<s?p/s:p<s+C?1-(p-s)/C*(1-E):p<s+C+n?E:p<k-m?(k-p-m)/r*E:0),x=m?x/2+(m>p?0:(p<k-m?1:(k-p)/m)*U[p-m|0]/2/e):x,Y&&(x=ot=vt*st+_t*(st=nt)+et*(nt=x)-xt*rt-yt*(rt=ot))),$=(i+=c+=u)*Math.cos(d*ft++),b+=$+$*g*Math.sin(p**5),I&&++I>l&&(i+=h,J+=h,I=0),f&&!(++wt%f)&&(i=J,c=pt,I=I||1);return U},getNote:function(e=0,t=440){return t*2**(e/12)}},j=()=>Vt(void 0,0,261.6256,.03,.01,.02,void 0,1.8,void 0,void 0,void 0,void 0,void 0,.3,285,.1,void 0,.52,.02,void 0,-1478),G=(e,t)=>{var i=new SpeechSynthesisUtterance;i.text=e||"hello world",t&&window.speechSynthesis.cancel(),window.speechSynthesis.speak(i)};class Qt{constructor(){M(this,"map");M(this,"position");M(this,"facing");M(this,"puzzle");M(this,"visitedRooms");M(this,"state");this.map=Zt,this.facing="",this.puzzle="",this.visitedRooms=[],this.state={},this.moveTo(this.map.rooms[0].name),N("activate",t=>{console.log("activate",t),this.state[t]=!0})}get currentRoom(){return this.map.rooms.find(t=>t.name===this.position)}get currentView(){var t;return(t=this.currentRoom)==null?void 0:t.views.find(i=>i.direction==this.facing)}get currentPuzzle(){var t;return(t=this.currentView)==null?void 0:t.puzzle}roomByName(t){return this.map.rooms.find(i=>i.name===t)}moveTo(t){var i;this.position=t,this.facing="",this.visitedRooms.includes(this.position)?this.inspect():(G((i=this.currentRoom)==null?void 0:i.intro),this.visitedRooms.push(this.position))}lookAt(t){this.facing=t,this.inspect()}inspect(){var t,i;this.facing===""?G((t=this.currentRoom)==null?void 0:t.description,!0):G((i=this.currentView)==null?void 0:i.description,!0)}interact(t){var i;if(!this.currentView){this.inspect();return}switch(t){case 0:(i=this.currentView)!=null&&i.interaction&&this.interaction(this.currentView.interaction);break}}interaction(t){for(let i=0;i<t.length;i++){const s=t[i];if(!(s.condition&&!this.state[s.condition])){s.message&&G(s.message),s.action&&this.action(s.action);return}}}action(t){const[i,s]=t.split("_");switch(i){case"moveTo":j(),this.moveTo(s);break;case"activate":j(),this.state[s]=!0;break;case"toggle":j(),this.state[s]=!this.state[s];break}}}const Jt=()=>{Xt(),Ht();const e=new Qt;Et();const t=[];t.push(jt(e)),Rt({update:function(s){t.forEach(n=>n.update(s))},render:function(){t.forEach(s=>s.render())}}).start()};document.querySelector("#app").innerHTML=`
  <div>
    <div id="intro">
      <div id="story">
        <h3>Story</h3>
        <p>You are a person. You are tasked with escaping the escape room.</p>
      </div>
      <div id="controls">
        <h3>Controls</h3>
        Use the keyboard and space bar to interact
      </div>
      <div class="logo">
        <button id="playButton">Play</button>
      </div>
    </div>
    <div class="card">
      <canvas id="renderCanvas" style="display:none;" width=640 height=480></canvas>
    </div>
  </div>
`;window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("playButton");e&&(e.onclick=()=>{document.getElementById("intro").style.display="none",document.getElementById("renderCanvas").style.display="block",Jt()})});
